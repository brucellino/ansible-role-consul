# Playbook to deploy a base Consul cluster
- name: Add python3
  hosts: pis
  gather_facts: false
  tasks:
    - name: Update APT
      ansible.builtin.raw: DEBIAN_FRONTEND=noninteractive apt-get update
      changed_when: false
    - name: Prep
      ansible.builtin.raw: |
        DEBIAN_FRONTEND=noninteractive \
        apt-get install -y \
          python3 \
          software-properties-common \
          sudo
      changed_when: false

- name: Deploy consul agents
  hosts: consul_agents:!consul_servers
  become: true
  roles:
    - role: ansible-role-consul
      is_server: false
      consul_port: 53
      consul_version: 1.14.3
      consul_template_version: 0.29.6
      vault_version: 1.12.2
  tags:
    - "agents"
